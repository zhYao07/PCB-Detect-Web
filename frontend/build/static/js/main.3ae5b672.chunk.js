(this["webpackJsonppcb-detect-frontend"]=this["webpackJsonppcb-detect-frontend"]||[]).push([[1],{152:function(e,t,s){},181:function(e,t,s){},182:function(e,t,s){},213:function(e,t,s){"use strict";s.r(t);var n=s(1),c=s.n(n),a=s(34),r=s.n(a),o=(s(152),s(229)),l=s(222),i=s(143),d=s(82),h=s(88),b=s(142),u=s(224),j=s(227),m=s(92),p=s(228),x=s(225),g=s(235),f=s(236),O=s(231),v=s(54),y=s(110),w=s(237),N=s(238),S=s(239),C=s(240),I=s(90),$=s(89),k=s(140),E=s(241),L=s(72),M=s.n(L),U=(s(179),s(180),s(181),s(223)),D=s(226),R=s(230),P=s(145),F=s(232),T=s(233),_=s(234),z=(s(182),s(6));const{TabPane:B}=l.a,A=()=>{const e=window.location.hostname,t=`${window.location.protocol}//${e}:5000`;return M.a.create({baseURL:t,withCredentials:!0})};var Y=e=>{let{onLoginSuccess:t}=e;const[s,c]=Object(n.useState)("login"),[a,r]=Object(n.useState)(!1),[o]=U.a.useForm(),[b]=U.a.useForm();Object(n.useEffect)((()=>{}),[]),Object(n.useEffect)((()=>{"login"===s?o.resetFields():b.resetFields()}),[s,o,b]);return Object(z.jsx)("div",{className:"login-container",style:{backgroundImage:"url(/output.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:"cover"},children:Object(z.jsxs)("div",{className:"login-content",children:[Object(z.jsxs)("div",{className:"login-header",children:[Object(z.jsx)("h1",{children:"\u6b22\u8fce\u4f7f\u7528\u6167\u773c\u8bc6\u7455\u7cfb\u7edf"}),Object(z.jsx)("p",{className:"login-subtitle",children:"\u57fa\u4e8eYOLOv11\u548c\u6295\u7968\u878d\u5408\u7684PCB\u7f3a\u9677\u68c0\u6d4b\u7cfb\u7edf"})]}),Object(z.jsxs)("div",{className:"login-box",children:[Object(z.jsx)("div",{className:"light-effect"}),Object(z.jsx)("div",{className:"light-effect"}),Object(z.jsxs)(l.a,{activeKey:s,onChange:c,centered:!0,className:"login-tabs",children:[Object(z.jsxs)(B,{tab:"\u767b\u5f55",children:[Object(z.jsxs)("div",{className:"login-welcome",children:[Object(z.jsx)(R.a,{className:"login-welcome-icon"}),Object(z.jsx)("p",{children:"\u8bf7\u8f93\u5165\u60a8\u7684\u8d26\u53f7\u4fe1\u606f\uff0c\u5b89\u5168\u767b\u5f55\u7cfb\u7edf"})]}),Object(z.jsxs)(U.a,{form:o,name:"login",onFinish:async e=>{let s;r(!0);try{s=A();const n=(await s.post("/api/login",e,{timeout:1e4})).data;"success"===n.status?(i.b.success("\u767b\u5f55\u6210\u529f\uff01"),localStorage.setItem("token",n.token),localStorage.setItem("user",JSON.stringify(n.user)),t(n.user)):i.b.error(n.error||"\u767b\u5f55\u5931\u8d25")}catch(n){console.error("\u767b\u5f55\u8bf7\u6c42\u51fa\u9519:",n),"ECONNABORTED"===n.code?i.b.error("\u8bf7\u6c42\u8d85\u65f6\uff0c\u670d\u52a1\u5668\u672a\u54cd\u5e94"):n.message&&n.message.includes("Network Error")?i.b.error(`\u7f51\u7edc\u9519\u8bef: \u65e0\u6cd5\u8fde\u63a5\u5230\u670d\u52a1\u5668 ${s.defaults.baseURL}`):n.response?i.b.error(`\u670d\u52a1\u5668\u9519\u8bef (${n.response.status}): ${n.response.data.error||"\u672a\u77e5\u9519\u8bef"}`):i.b.error(`\u767b\u5f55\u5931\u8d25: ${n.message||"\u672a\u77e5\u9519\u8bef"}`)}finally{r(!1)}},layout:"vertical",size:"large",children:[Object(z.jsx)(U.a.Item,{name:"username",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"}],children:Object(z.jsx)(D.a,{prefix:Object(z.jsx)(O.a,{}),placeholder:"\u7528\u6237\u540d",suffix:Object(z.jsx)(d.a,{title:"\u652f\u6301\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u4e0b\u5212\u7ebf\u7ec4\u5408",children:Object(z.jsx)(P.a,{style:{color:"rgba(0,0,0,.45)"}})})})}),Object(z.jsx)(U.a.Item,{name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"}],children:Object(z.jsx)(D.a.Password,{prefix:Object(z.jsx)(F.a,{}),placeholder:"\u5bc6\u7801"})}),Object(z.jsx)(U.a.Item,{children:Object(z.jsx)(h.a,{type:"primary",htmlType:"submit",block:!0,loading:a,className:"login-button",children:"\u767b\u5f55"})})]})]},"login"),Object(z.jsxs)(B,{tab:"\u6ce8\u518c",children:[Object(z.jsxs)("div",{className:"login-welcome",children:[Object(z.jsx)(O.a,{className:"login-welcome-icon",style:{color:"#1890ff"}}),Object(z.jsx)("p",{children:"\u6b22\u8fce\u6ce8\u518c\uff0c\u8bf7\u586b\u5199\u4ee5\u4e0b\u4fe1\u606f"})]}),Object(z.jsxs)(U.a,{form:b,name:"register",onFinish:async e=>{let t;r(!0);try{t=A(),await t.post("/api/register",{username:e.username,password:e.password,email:e.email,phone:e.phone},{timeout:1e4}),i.b.success("\u6ce8\u518c\u6210\u529f\uff01\u8bf7\u767b\u5f55"),c("login"),o.setFieldsValue({username:e.username,password:e.password})}catch(s){console.error("\u6ce8\u518c\u8bf7\u6c42\u51fa\u9519:",s),"ECONNABORTED"===s.code?i.b.error("\u8bf7\u6c42\u8d85\u65f6\uff0c\u670d\u52a1\u5668\u672a\u54cd\u5e94"):s.message&&s.message.includes("Network Error")?i.b.error(`\u7f51\u7edc\u9519\u8bef: \u65e0\u6cd5\u8fde\u63a5\u5230\u670d\u52a1\u5668 ${t.defaults.baseURL}`):s.response?i.b.error(`\u670d\u52a1\u5668\u9519\u8bef (${s.response.status}): ${s.response.data.error||"\u672a\u77e5\u9519\u8bef"}`):i.b.error(`\u6ce8\u518c\u5931\u8d25: ${s.message||"\u672a\u77e5\u9519\u8bef"}`)}finally{r(!1)}},layout:"vertical",size:"large",children:[Object(z.jsx)(U.a.Item,{name:"username",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"}],children:Object(z.jsx)(D.a,{prefix:Object(z.jsx)(O.a,{}),placeholder:"\u7528\u6237\u540d",suffix:Object(z.jsx)(d.a,{title:"\u652f\u6301\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u4e0b\u5212\u7ebf\u7ec4\u5408",children:Object(z.jsx)(P.a,{style:{color:"rgba(0,0,0,.45)"}})})})}),Object(z.jsx)(U.a.Item,{name:"email",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u90ae\u7bb1"},{type:"email",message:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u90ae\u7bb1\u5730\u5740"}],children:Object(z.jsx)(D.a,{prefix:Object(z.jsx)(T.a,{}),placeholder:"\u90ae\u7bb1"})}),Object(z.jsx)(U.a.Item,{name:"phone",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u624b\u673a\u53f7"},{pattern:/^1[3-9]\d{9}$/,message:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u624b\u673a\u53f7"}],children:Object(z.jsx)(D.a,{prefix:Object(z.jsx)(_.a,{}),placeholder:"\u624b\u673a\u53f7"})}),Object(z.jsx)(U.a.Item,{name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"},{min:6,message:"\u5bc6\u7801\u957f\u5ea6\u81f3\u5c11\u4e3a6\u4f4d"}],children:Object(z.jsx)(D.a.Password,{prefix:Object(z.jsx)(F.a,{}),placeholder:"\u5bc6\u7801"})}),Object(z.jsx)(U.a.Item,{name:"confirmPassword",dependencies:["password"],rules:[{required:!0,message:"\u8bf7\u786e\u8ba4\u5bc6\u7801"},e=>{let{getFieldValue:t}=e;return{validator:(e,s)=>s&&t("password")!==s?Promise.reject(new Error("\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4")):Promise.resolve()}}],children:Object(z.jsx)(D.a.Password,{prefix:Object(z.jsx)(F.a,{}),placeholder:"\u786e\u8ba4\u5bc6\u7801"})}),Object(z.jsx)(U.a.Item,{children:Object(z.jsx)(h.a,{type:"primary",htmlType:"submit",block:!0,loading:a,className:"login-button",children:"\u6ce8\u518c"})})]})]},"register")]}),Object(z.jsxs)("div",{className:"login-footer",children:[Object(z.jsxs)("p",{children:["\u6280\u672f\u652f\u6301: ",Object(z.jsx)("span",{children:"\u4ece\u96f6\u5f00\u59cb\u7684\u4ee3\u7801\u751f\u6d3b"})]}),Object(z.jsxs)("p",{children:["\u7cfb\u7edf\u7248\u672c: ",Object(z.jsx)("span",{children:"V2.3.1"})]})]})]})]})})};const H=`${window.location.protocol}//${window.location.host}`;M.a.defaults.baseURL=H,M.a.defaults.withCredentials=!0;const{Header:W,Sider:q,Content:J}=o.a,{TabPane:X}=l.a;var G=function(){const[e,t]=Object(n.useState)({status:"normal",cpuUsage:0,memoryUsage:0,uptime:"0h 0m"}),[c,a]=Object(n.useState)({defects:[],statistics:{defect_types:{}}}),[r,l]=Object(n.useState)(null),[L,U]=Object(n.useState)(!1),[D,R]=Object(n.useState)(0),[P,F]=Object(n.useState)(1),[T,_]=Object(n.useState)([]),[B,A]=Object(n.useState)(0),[H,q]=Object(n.useState)(!1),[J,X]=Object(n.useState)(0),[G,V]=Object(n.useState)(!1),[K,Q]=Object(n.useState)([]),[Z,ee]=Object(n.useState)([]),[te,se]=Object(n.useState)(!1),[ne,ce]=Object(n.useState)(!1),[ae,re]=Object(n.useState)({x:0,y:0}),[oe,le]=Object(n.useState)({x:0,y:0}),[ie,de]=Object(n.useState)(1),[he,be]=Object(n.useState)({x:0,y:0}),ue=Object(n.useRef)(null),[je,me]=Object(n.useState)(!1),[pe,xe]=Object(n.useState)("all"),[ge,fe]=Object(n.useState)([]),[Oe,ve]=Object(n.useState)(["all","mouse_bite","open_circuit","short","spur","spurious_copper"]),ye=Object(n.useRef)(!1),[we,Ne]=Object(n.useState)(!1),[Se,Ce]=Object(n.useState)(null),Ie=Object(n.useRef)(null),[$e,ke]=Object(n.useState)(!1),[Ee,Le]=Object(n.useState)(null),[Me,Ue]=Object(n.useState)("0\u79d2"),[De,Re]=Object(n.useState)(null),Pe=(Object(n.useRef)(""),Object(n.useRef)(null)),[Fe,Te]=Object(n.useState)(!1),[_e,ze]=Object(n.useState)(!1),[Be,Ae]=Object(n.useState)(null),[Ye,He]=Object(n.useState)(null),We=Object(n.useRef)(null);Object(n.useEffect)((()=>{const e=async()=>{try{const e=await M.a.get("/api/system-status");t({status:e.data.status,cpuUsage:e.data.cpu_usage,memoryUsage:e.data.memory_usage,uptime:e.data.uptime})}catch(e){console.error("Error fetching system status:",e),i.b.error("\u7cfb\u7edf\u72b6\u6001\u66f4\u65b0\u5931\u8d25")}};e();const s=setInterval(e,5e3);return()=>clearInterval(s)}),[]),Object(n.useEffect)((()=>{ye.current=je}),[je]),Object(n.useEffect)((()=>{Ie.current&&Se&&(console.log("videoStream\u53d8\u5316\uff0c\u8bbe\u7f6e\u89c6\u9891\u6e90..."),Ie.current.srcObject=Se,Ie.current.play().then((()=>console.log("\u89c6\u9891\u64ad\u653e\u6210\u529f [useEffect]"))).catch((e=>{console.error("\u89c6\u9891\u64ad\u653e\u5931\u8d25 [useEffect]:",e),i.b.error("\u89c6\u9891\u64ad\u653e\u5931\u8d25: "+e.message)})))}),[Se]),Object(n.useEffect)((()=>()=>{Z.forEach((e=>URL.revokeObjectURL(e)))}),[Z]),Object(n.useEffect)((()=>()=>{De&&clearInterval(De),Se&&Se.getTracks().forEach((e=>e.stop())),Ee&&clearInterval(Ee)}),[]),Object(n.useEffect)((()=>{const e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&t&&(ze(!0),Ae(JSON.parse(t)))}),[]);const qe=()=>{console.log("\u91cd\u7f6e\u56fe\u50cf\u548c\u68c0\u6d4b\u72b6\u6001\u5f00\u59cb"),Z.forEach((e=>{try{URL.revokeObjectURL(e)}catch(t){console.error("\u64a4\u9500URL\u65f6\u51fa\u9519:",t)}})),_([]),ee([]),l(null),A(0),Q([]),a({defects:[],statistics:{defect_types:{}}}),fe([]),R(0),X(0),de(1),be({x:0,y:0}),He(null),console.log("\u91cd\u7f6e\u56fe\u50cf\u548c\u68c0\u6d4b\u72b6\u6001\u5b8c\u6210")},Je=async()=>{if(dt(null),We.current=null,bt(null),Ue("0\u79d2"),$e){if(Ee&&(clearInterval(Ee),Le(null)),De&&(clearInterval(De),Re(null)),We.current){const e=Date.now();bt(e);const t=Math.floor((e-We.current)/1e3),s=Math.floor(t/3600),n=Math.floor(t%3600/60);Ue(`${s}\u5c0f\u65f6${n}\u5206\u949f${t%60}\u79d2`)}return ke(!1),a({defects:[],statistics:{defect_types:{}}}),void i.b.info("\u5df2\u505c\u6b62\u5b9e\u65f6\u68c0\u6d4b")}if(!we)return void i.b.warning("\u8bf7\u5148\u6253\u5f00\u6444\u50cf\u5934");if(!Ie.current||!Ie.current.srcObject)return console.error("\u89c6\u9891\u5143\u7d20\u672a\u51c6\u5907\u5c31\u7eea"),void i.b.error("\u89c6\u9891\u672a\u51c6\u5907\u5c31\u7eea\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u6444\u50cf\u5934");try{(Ie.current.paused||Ie.current.ended)&&(await Ie.current.play(),console.log("\u91cd\u65b0\u5f00\u59cb\u64ad\u653e\u89c6\u9891"))}catch(n){return console.error("\u65e0\u6cd5\u64ad\u653e\u89c6\u9891:",n),void i.b.error("\u65e0\u6cd5\u64ad\u653e\u89c6\u9891")}const e=Date.now();dt(e),We.current=e,bt(null);const t=setInterval((()=>{const e=Date.now(),t=Math.floor((e-We.current)/1e3),s=Math.floor(t/3600),n=Math.floor(t%3600/60);Ue(`${s}\u5c0f\u65f6${n}\u5206\u949f${t%60}\u79d2`)}),1e3);Re(t),ke(!0),i.b.info("\u5f00\u59cb\u5b9e\u65f6\u68c0\u6d4b"),console.log("\u5f00\u59cb\u5b9e\u65f6\u68c0\u6d4b\uff0c\u89c6\u9891\u6d41\u72b6\u6001:",Ie.current.readyState);const s=setInterval((async()=>{try{if(!Ie.current||!Ie.current.srcObject||!we)return console.warn("\u89c6\u9891\u5143\u7d20\u4e0d\u5b58\u5728\u6216\u6444\u50cf\u5934\u5df2\u5173\u95ed\uff0c\u505c\u6b62\u68c0\u6d4b"),clearInterval(s),De&&(clearInterval(De),Re(null)),ke(!1),Le(null),void i.b.warning("\u6444\u50cf\u5934\u5df2\u65ad\u5f00\uff0c\u5b9e\u65f6\u68c0\u6d4b\u505c\u6b62");if(Ie.current.paused||Ie.current.ended){console.warn("\u89c6\u9891\u6682\u505c\u6216\u7ed3\u675f\uff0c\u5c1d\u8bd5\u91cd\u65b0\u64ad\u653e");try{await Ie.current.play()}catch(e){return console.error("\u65e0\u6cd5\u91cd\u65b0\u64ad\u653e\u89c6\u9891:",e),i.b.error("\u65e0\u6cd5\u6062\u590d\u89c6\u9891\u64ad\u653e\uff0c\u5b9e\u65f6\u68c0\u6d4b\u505c\u6b62"),clearInterval(s),De&&(clearInterval(De),Re(null)),ke(!1),void Le(null)}}const t=await(()=>{if(!Ie.current||!we)return console.error("\u89c6\u9891\u5143\u7d20\u4e0d\u53ef\u7528\u6216\u6444\u50cf\u5934\u672a\u6fc0\u6d3b"),null;if(Ie.current.paused||Ie.current.ended)return console.warn("\u89c6\u9891\u5df2\u6682\u505c\u6216\u7ed3\u675f\uff0c\u5c1d\u8bd5\u91cd\u65b0\u64ad\u653e"),Ie.current.play().catch((e=>{console.error("\u65e0\u6cd5\u91cd\u65b0\u64ad\u653e\u89c6\u9891:",e)})),null;const e=Ie.current.videoWidth,t=Ie.current.videoHeight;if(!e||!t)return console.warn("\u89c6\u9891\u5c3a\u5bf8\u65e0\u6548:",e,t),null;let s,n;console.log("\u6355\u83b7\u89c6\u9891\u5e27\uff0c\u539f\u59cb\u5c3a\u5bf8:",e,"x",t),e>600||t>600?(s=600,n=Math.round(t/e*600)):(s=e,n=t),console.log("\u6355\u83b7\u89c6\u9891\u5e27\uff0c\u7f29\u653e\u540e\u5c3a\u5bf8:",s,"x",n);const c=document.createElement("canvas");c.width=e,c.height=t,c.getContext("2d").drawImage(Ie.current,0,0,e,t);const a=document.createElement("canvas");return a.width=s,a.height=n,a.getContext("2d").drawImage(c,0,0,e,t,0,0,s,n),He({width:s,height:n}),new Promise((e=>{a.toBlob((t=>{if(!t)return console.error("\u65e0\u6cd5\u521b\u5efaBlob"),void e(null);const s=new File([t],"camera-capture.jpg",{type:"image/jpeg"});e(s)}),"image/jpeg",.95)}))})();if(t){console.log("\u6210\u529f\u6355\u83b7\u89c6\u9891\u5e27",(new Date).toLocaleTimeString()),R(20);const e=await lt(t);console.log("\u68c0\u6d4b\u7ed3\u679c:",e.defects.length>0?`\u53d1\u73b0${e.defects.length}\u4e2a\u7f3a\u9677`:"\u672a\u53d1\u73b0\u7f3a\u9677"),we&&Ie.current&&(Ie.current.paused&&(console.log("\u68c0\u6d4b\u671f\u95f4\u89c6\u9891\u6682\u505c\uff0c\u5c1d\u8bd5\u6062\u590d"),Ie.current.play().catch((e=>console.error("\u65e0\u6cd5\u6062\u590d\u89c6\u9891:",e)))),fe([]),a(e)),R(100)}else console.warn("\u672a\u80fd\u6355\u83b7\u89c6\u9891\u5e27")}catch(t){console.error("\u5b9e\u65f6\u68c0\u6d4b\u9519\u8bef:",t),i.b.error("\u5b9e\u65f6\u68c0\u6d4b\u51fa\u9519: "+t.message)}}),2e3);Le(s)},Xe=()=>{console.log("\u91cd\u7f6e\u6240\u6709\u72b6\u6001\u5f00\u59cb\uff0c\u6444\u50cf\u5934\u72b6\u6001:",we),De&&(clearInterval(De),Re(null)),Ue("0\u79d2"),dt(null),We.current=null,bt(null),we?qe():(Z.forEach((e=>{try{URL.revokeObjectURL(e)}catch(t){console.error("\u64a4\u9500URL\u65f6\u51fa\u9519:",t)}})),Se&&Se.getTracks().forEach((e=>e.stop())),Ce(null),Ne(!1),Ee&&(clearInterval(Ee),Le(null)),_([]),ee([]),l(null),A(0),Q([]),a({defects:[],statistics:{defect_types:{}}}),fe([]),R(0),X(0),de(1),be({x:0,y:0}),console.log("\u91cd\u7f6e\u6240\u6709\u72b6\u6001\u5b8c\u6210"))},Ge=e=>{if(c&&c.defects)if("all"===e)fe(c.defects);else{const t=c.defects.filter((t=>t.type.toLowerCase()===e.toLowerCase()));fe(t)}};Object(n.useEffect)((()=>{if(c&&c.defects){const e=["all"];c.defects.forEach((t=>{e.includes(t.type.toLowerCase())||e.push(t.type.toLowerCase())})),ve(e),Ge(pe)}}),[c]);const Ve=e=>({mouse_bite:"#ff7875",open_circuit:"#40a9ff",short:"#ffc53d",spur:"#73d13d",spurious_copper:"#9254de"}[e.toLowerCase()]||"#ff7875"),Ke=()=>{if(!r&&!we||!ge||0===ge.length)return null;let e={left:0,top:0,width:0,height:0},t=1;if(we&&Ie.current&&Ye){const s=Ie.current,n=(window.getComputedStyle(s),s.getBoundingClientRect()),c=s.parentElement.getBoundingClientRect();e={width:n.width,height:n.height,left:n.left-c.left,top:n.top-c.top};const a=e.width/Ye.width,r=e.height/Ye.height;t=Math.min(a,r),console.log("\u89c6\u9891\u4f4d\u7f6e\u8ba1\u7b97:",{videoPosition:e,imageSize:Ye,scale:t,boxOffset:{x:e.left,y:e.top}})}return ge.map(((s,n)=>{if(s.bbox){let{x1:e,y1:t,x2:c,y2:a}=s.bbox;if(we&&Ye){let s=1,n=0,r=0;if(we&&Ye&&ue.current){const e=ue.current.getBoundingClientRect(),t=e.width,c=e.height,{width:a,height:o}=Ye,l=a/o;let i,d;l>t/c?(i=t,d=i/l):(d=c,i=d*l),n=(t-i)/2,r=(c-d)/2,s=i/a}e=e*s+n,t=t*s+r,c=c*s+n,a=a*s+r}const r=c-e,o=a-t;return Object(z.jsx)("div",{style:{position:"absolute",left:`${e}px`,top:`${t}px`,width:`${r}px`,height:`${o}px`,border:`2px solid ${Ve(s.type)}`,backgroundColor:"rgba(255, 255, 255, 0.1)",pointerEvents:"none",zIndex:100},children:Object(z.jsxs)("div",{style:{position:"absolute",top:"-20px",left:"0",background:Ve(s.type),color:"white",padding:"0 4px",fontSize:"10px",whiteSpace:"nowrap"},children:[s.type," ",s.confidence?`(${s.confidence}%)`:""]})},n)}if(s.position){const c=60,a=40;let r=s.position.x-c/2,o=s.position.y-a/2;return we&&Ye&&(r=r*t+e.left,o=o*t+e.top),Object(z.jsx)("div",{style:{position:"absolute",left:`${r}px`,top:`${o}px`,width:`${c}px`,height:`${a}px`,border:`2px solid ${Ve(s.type)}`,backgroundColor:"rgba(255, 255, 255, 0.1)",pointerEvents:"none",zIndex:100},children:Object(z.jsxs)("div",{style:{position:"absolute",top:"-20px",left:"0",background:Ve(s.type),color:"white",padding:"0 4px",fontSize:"10px",whiteSpace:"nowrap"},children:[s.type," ",s.confidence?`(${s.confidence}%)`:""]})},n)}return null}))},Qe=e=>{if(!e)return!1;se(!0);const t=new Image;return t.onload=()=>{let s,n;t.width>600||t.height>600?(s=600,n=Math.round(t.height/t.width*600)):(s=t.width,n=t.height);const c=document.createElement("canvas");c.width=s,c.height=n;c.getContext("2d").drawImage(t,0,0,s,n),c.toBlob((async t=>{try{He({width:s,height:n});const c=new File([t],e.name,{type:e.type}),r=URL.createObjectURL(t);_([c]),ee([r]),l(r),A(0),Q([]),a({defects:[],statistics:{defect_types:{}}}),fe([]),R(0),X(0),i.b.success("\u56fe\u7247\u5bfc\u5165\u6210\u529f")}catch(c){console.error("\u56fe\u7247\u5904\u7406\u9519\u8bef:",c),i.b.error("\u56fe\u7247\u5904\u7406\u5931\u8d25")}finally{se(!1)}}),e.type,.95)},t.onerror=()=>{console.error("\u56fe\u7247\u52a0\u8f7d\u5931\u8d25"),i.b.error("\u56fe\u7247\u52a0\u8f7d\u5931\u8d25"),se(!1)},t.src=URL.createObjectURL(e),!1},Ze=((e,t)=>{let s;return function(){for(var n=arguments.length,c=new Array(n),a=0;a<n;a++)c[a]=arguments[a];const r=this;clearTimeout(s),s=setTimeout((()=>e.apply(r,c)),t)}})((e=>{console.log("\u6587\u4ef6\u5939\u4e0a\u4f20\u4fe1\u606f (\u9632\u6296\u5904\u7406):",e),se(!0);try{if(Xe(),!e||!e.fileList||0===e.fileList.length)return i.b.warning("\u672a\u627e\u5230\u6587\u4ef6"),void se(!1);const s=[];if(e.fileList.forEach((e=>{const t=e.originFileObj||e;t&&t.type&&t.type.startsWith("image/")&&s.push(t)})),console.log("\u5bfc\u5165\u7684\u56fe\u7247\u6587\u4ef6\u6570\u91cf:",s.length),0===s.length)return i.b.warning("\u672a\u627e\u5230\u56fe\u7247\u6587\u4ef6"),void se(!1);const n=[];for(const e of s)try{const t=URL.createObjectURL(e);n.push(t)}catch(t){console.error("\u65e0\u6cd5\u4e3a\u6587\u4ef6\u521b\u5efaURL:",e.name,t)}if(0===n.length)return i.b.error("\u65e0\u6cd5\u5904\u7406\u56fe\u7247\u6587\u4ef6"),void se(!1);_(s),ee(n),l(n[0]),i.b.success(`\u6210\u529f\u5bfc\u5165 ${s.length} \u5f20\u56fe\u7247`)}catch(s){console.error("\u6587\u4ef6\u5939\u5bfc\u5165\u9519\u8bef:",s),i.b.error("\u6587\u4ef6\u5939\u5bfc\u5165\u5931\u8d25"),Xe()}finally{se(!1)}}),300),et=()=>{de(1),be({x:0,y:0})},tt=e=>{e>=0&&e<T.length&&(A(e),l(Z[e]),et(),K[e]&&a(K[e].result))},[st,nt]=Object(n.useState)("yolov11"),[ct,at]=Object(n.useState)(.45),[rt,ot]=Object(n.useState)(.4),lt=async e=>{try{const t=new FormData;t.append("image",e);const s={vote_threshold:"yolov11-vote2"===st?1:"yolov11-vote4"===st?2:1,orientation_count:"yolov11-vote2"===st?2:"yolov11-vote4"===st?4:1,iou_threshold:ct,conf_threshold:rt};Ye&&(s.img_width=Ye.width,s.img_height=Ye.height);return(await M.a.post("/api/detect",t,{params:s})).data}catch(t){throw new Error(`\u68c0\u6d4b\u5931\u8d25: ${t.message}`)}},[it,dt]=Object(n.useState)(null),[ht,bt]=Object(n.useState)(null);Object(n.useEffect)((()=>{if(r){const e=e=>{let t=e.target,s=!1;for(;t;){if(t===ue.current){s=!0;break}t=t.parentElement}s&&e.preventDefault()};return ue.current&&ue.current.addEventListener("wheel",e,{passive:!1}),()=>{ue.current&&ue.current.removeEventListener("wheel",e)}}}),[r]),Object(n.useEffect)((()=>{document.body.style.overflow="",document.documentElement.style.overflow=""}),[]);const ut=()=>{ce(!1)},jt=e=>{ze(!0),Ae(e)};return Object(n.useEffect)((()=>{Ye&&c&&c.defects&&(console.log("\u56fe\u50cf\u5c3a\u5bf8\u66f4\u65b0\uff0c\u91cd\u65b0\u5e94\u7528\u8fb9\u754c\u6846:",Ye),Ge(pe))}),[Ye]),Object(n.useEffect)((()=>{if(we&&Ie.current){const e=new ResizeObserver((()=>{ge&&ge.length>0&&(console.log("\u89c6\u9891\u5143\u7d20\u5c3a\u5bf8\u53d8\u5316\uff0c\u91cd\u65b0\u5e94\u7528\u8fb9\u754c\u6846"),fe([...ge]))}));return e.observe(Ie.current),()=>{e.disconnect()}}}),[we,Ie.current,ge]),_e?Object(z.jsxs)(o.a,{className:"app-container",children:[Object(z.jsxs)(W,{className:"header",children:[Object(z.jsxs)("div",{className:"header-left",children:[Object(z.jsx)("img",{src:"/logo.svg",alt:"logo",className:"logo"}),Object(z.jsx)("h1",{children:"\u57fa\u4e8eYOLOv11\u548c\u6295\u7968\u878d\u5408\u7684PCB\u7f3a\u9677\u68c0\u6d4b\u7cfb\u7edf"})]}),Object(z.jsxs)("div",{className:"header-right",children:[Object(z.jsx)(g.a,{className:"header-icon"}),Object(z.jsx)(f.a,{className:"header-icon"}),Object(z.jsx)(d.a,{title:"\u9000\u51fa\u767b\u5f55",children:Object(z.jsx)(O.a,{className:"header-icon",onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),ze(!1),Ae(null)},style:{cursor:"pointer"}})})]})]}),Object(z.jsx)(o.a,{style:{padding:"24px",background:"#f0f2f5"},children:Object(z.jsxs)("div",{style:{display:"flex",gap:"24px",minWidth:"fit-content"},children:[Object(z.jsxs)("div",{className:"sidebar",children:[Object(z.jsx)(h.a,{type:"primary",className:"start-detection-button",style:{background:H&&!je||$e?"#f5222d":"#37c537",border:"none"},onClick:async()=>{if(dt(null),We.current=null,bt(null),Ue("0\u79d2"),we)return void Je();if(0===T.length)return void i.b.warning("\u8bf7\u5148\u5bfc\u5165\u56fe\u7247");if(H){const e=!je;return me(e),ye.current=e,void i.b.info(e?"\u6682\u505c\u68c0\u6d4b":"\u7ee7\u7eed\u68c0\u6d4b")}q(!0),U(!0),me(!1),ye.current=!1;const e=Date.now();dt(e),We.current=e,bt(null);const t=setInterval((()=>{const e=Date.now(),t=Math.floor((e-We.current)/1e3),s=Math.floor(t/3600),n=Math.floor(t%3600/60);Ue(`${s}\u5c0f\u65f6${n}\u5206\u949f${t%60}\u79d2`)}),1e3);Re(t);let s=[],n=0;try{for(R(1);n<T.length;){if(ye.current){await new Promise((e=>{const t=setInterval((()=>{ye.current||(clearInterval(t),e())}),100)}));continue}a({defects:[],statistics:{defect_types:{}}}),fe([]),A(n),l(Z[n]);const e=Math.round((n+1)/T.length*100);X(e),R(e);const t=await lt(T[n]);s.push({imageUrl:Z[n],result:t}),a(t),await new Promise((e=>setTimeout(e,1e3))),ye.current||n++}Q(s),clearInterval(De),Re(null);const e=Date.now();bt(e);const t=Math.floor((e-We.current)/1e3),c=Math.floor(t/3600),r=Math.floor(t%3600/60);Ue(`${c}\u5c0f\u65f6${r}\u5206\u949f${t%60}\u79d2`),i.b.success("\u68c0\u6d4b\u5b8c\u6210"),q(!1)}catch(c){clearInterval(De),Re(null),i.b.error(c.message),q(!1)}finally{U(!1)}},icon:H&&!je?Object(z.jsx)(v.a,{}):Object(z.jsx)(y.a,{}),children:we&&$e?"\u505c\u6b62\u68c0\u6d4b":we?"\u5f00\u59cb\u68c0\u6d4b":H?je?"\u7ee7\u7eed\u68c0\u6d4b":"\u6682\u505c\u68c0\u6d4b":"\u5f00\u59cb\u68c0\u6d4b"}),Object(z.jsxs)("div",{className:"system-status-section",children:[Object(z.jsx)("h3",{children:"\u7cfb\u7edf\u72b6\u6001"}),Object(z.jsxs)("div",{className:"status-item status-cpu",style:{display:"flex",alignItems:"flex-start"},children:[Object(z.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"50px"},children:[Object(z.jsx)("div",{className:"status-icon status-icon-cpu"}),Object(z.jsxs)("span",{className:"status-value",style:{marginTop:"5px",backgroundColor:"rgba(24, 144, 255, 0.2)",padding:"2px 8px",borderRadius:"10px",fontSize:"12px",color:"#1890ff",textAlign:"center"},children:[Math.min(Math.max(Math.round(e.cpuUsage||0),0),100),"%"]})]}),Object(z.jsxs)("div",{className:"status-content",style:{marginLeft:"10px",marginTop:"2px"},children:[Object(z.jsx)("div",{className:"status-header",children:Object(z.jsx)("span",{className:"status-label",children:"CPU\u4f7f\u7528\u7387"})}),Object(z.jsx)("div",{style:{position:"relative"},children:Object(z.jsx)(b.a,{percent:Math.min(Math.max(Math.round(e.cpuUsage||0),0),100),size:"small",status:e.cpuUsage>80?"exception":"normal",showInfo:!1,strokeColor:{"0%":"#108ee9","100%":e.cpuUsage>80?"#f5222d":"#52c41a"}})})]})]}),Object(z.jsxs)("div",{className:"status-item status-memory",style:{display:"flex",alignItems:"flex-start"},children:[Object(z.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"50px"},children:[Object(z.jsx)("div",{className:"status-icon status-icon-memory"}),Object(z.jsxs)("span",{className:"status-value",style:{marginTop:"5px",backgroundColor:"rgba(114, 46, 209, 0.2)",padding:"2px 8px",borderRadius:"10px",fontSize:"12px",color:"#722ed1",textAlign:"center"},children:[Math.min(Math.max(Math.round(e.memoryUsage||0),0),100),"%"]})]}),Object(z.jsxs)("div",{className:"status-content",style:{marginLeft:"10px",marginTop:"2px"},children:[Object(z.jsx)("div",{className:"status-header",children:Object(z.jsx)("span",{className:"status-label",children:"\u5185\u5b58\u4f7f\u7528\u7387"})}),Object(z.jsx)("div",{style:{position:"relative"},children:Object(z.jsx)(b.a,{percent:Math.min(Math.max(Math.round(e.memoryUsage||0),0),100),size:"small",status:e.memoryUsage>80?"exception":"normal",showInfo:!1,strokeColor:{"0%":"#722ed1","100%":e.memoryUsage>80?"#f5222d":"#13c2c2"}})})]})]}),Object(z.jsxs)("div",{className:"status-item status-time",style:{display:"flex",alignItems:"flex-start"},children:[Object(z.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"50px"},children:Object(z.jsx)("div",{className:"status-icon status-icon-time"})}),Object(z.jsxs)("div",{className:"status-content",style:{marginLeft:"10px",marginTop:"2px"},children:[Object(z.jsx)("div",{className:"status-header",children:Object(z.jsx)("span",{className:"status-label",children:"\u8fd0\u884c\u65f6\u957f"})}),Object(z.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:"5px"},children:Object(z.jsx)("span",{className:"status-time-value",style:{backgroundColor:"rgba(250, 173, 20, 0.2)",padding:"4px 12px",borderRadius:"30px",fontSize:"12px",color:"#faad14",whiteSpace:"nowrap",textAlign:"center"},children:H||$e?Me:ht&&it?(()=>{if(!it||!ht)return"N/A";const e=Math.floor((ht-it)/1e3);return`${Math.floor(e/3600)}\u5c0f\u65f6${Math.floor(e%3600/60)}\u5206\u949f${e%60}\u79d2`})():"0\u79d2"})})]})]})]}),Object(z.jsxs)("div",{className:"sidebar-actions",children:[Object(z.jsx)(u.a,{accept:"image/*",showUploadList:!1,beforeUpload:Qe,disabled:te||L||we,children:Object(z.jsx)(h.a,{className:"action-btn",style:{width:"160px"},icon:Object(z.jsx)(w.a,{className:"btn-icon"}),disabled:te||L||we,children:"\u5bfc\u5165\u56fe\u50cf"})}),Object(z.jsx)(u.a,{directory:!0,multiple:!0,accept:"image/*",showUploadList:!1,beforeUpload:()=>!1,onChange:Ze,disabled:te||L||we,fileList:[],children:Object(z.jsx)(h.a,{className:"action-btn",style:{width:"160px"},icon:Object(z.jsx)(N.a,{className:"btn-icon"}),disabled:te||L||we,children:"\u5bfc\u5165\u6587\u4ef6\u5939"})}),Object(z.jsx)(h.a,{className:"action-btn",icon:we?Object(z.jsx)(S.a,{className:"btn-icon"}):Object(z.jsx)(C.a,{className:"btn-icon"}),onClick:async()=>{try{if(console.log("\u5f00\u59cb\u6253\u5f00/\u5173\u95ed\u6444\u50cf\u5934\u64cd\u4f5c, \u5f53\u524d\u72b6\u6001:",{isCameraActive:we}),we)return console.log("\u6b63\u5728\u5173\u95ed\u6444\u50cf\u5934..."),Se&&Se.getTracks().forEach((e=>e.stop())),Ce(null),Ne(!1),$e&&(ke(!1),Ee&&(clearInterval(Ee),Le(null))),R(0),_([]),ee([]),l(null),A(0),Q([]),a({defects:[],statistics:{defect_types:{}}}),fe([]),He(null),de(1),be({x:0,y:0}),void i.b.success("\u6444\u50cf\u5934\u5df2\u5173\u95ed");if(qe(),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void i.b.error("\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u8bbf\u95ee\u6444\u50cf\u5934\u529f\u80fd");console.log("\u6b63\u5728\u8bf7\u6c42\u6444\u50cf\u5934\u6743\u9650...");const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}}});if(console.log("\u6210\u529f\u83b7\u53d6\u6444\u50cf\u5934\u6d41"),Ne(!0),Ce(t),await new Promise((e=>setTimeout(e,50))),Ie.current){console.log("\u8bbe\u7f6e\u89c6\u9891\u5143\u7d20\u6e90..."),Ie.current.srcObject=t;try{await Ie.current.play(),console.log("\u89c6\u9891\u64ad\u653e\u6210\u529f")}catch(e){console.error("\u89c6\u9891\u64ad\u653e\u5931\u8d25:",e)}}i.b.success("\u6444\u50cf\u5934\u5df2\u6253\u5f00")}catch(t){console.error("\u65e0\u6cd5\u8bbf\u95ee\u6444\u50cf\u5934:",t),"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?i.b.error("\u6444\u50cf\u5934\u8bbf\u95ee\u88ab\u62d2\u7edd\uff0c\u8bf7\u5728\u6d4f\u89c8\u5668\u4e2d\u5141\u8bb8\u8bbf\u95ee\u6444\u50cf\u5934"):"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?i.b.error("\u672a\u627e\u5230\u6444\u50cf\u5934\u8bbe\u5907\uff0c\u8bf7\u786e\u4fdd\u60a8\u7684\u8bbe\u5907\u5df2\u8fde\u63a5\u6444\u50cf\u5934"):"NotReadableError"===t.name||"TrackStartError"===t.name?i.b.error("\u65e0\u6cd5\u8bfb\u53d6\u6444\u50cf\u5934\uff0c\u53ef\u80fd\u88ab\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u5360\u7528"):i.b.error("\u65e0\u6cd5\u8bbf\u95ee\u6444\u50cf\u5934: "+t.message)}},style:{width:"160px",color:we?"#f5222d":""},children:we?"\u5173\u95ed\u6444\u50cf\u5934":"\u6253\u5f00\u6444\u50cf\u5934"}),Object(z.jsx)(h.a,{className:"action-btn",style:{width:"160px"},icon:Object(z.jsx)(y.a,{className:"btn-icon"}),onClick:async()=>{if(c.defects.length)try{if(!window.showDirectoryPicker)return void i.b.error("\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u6587\u4ef6\u5939\u9009\u62e9\u529f\u80fd");const c=await window.showDirectoryPicker(),a=await c.getDirectoryHandle("Annotated_Images",{create:!0}),r=await c.getDirectoryHandle("JSON_Files",{create:!0});for(let o=0;o<T.length;o++){var e,t,s,n;const c=T[o].name.split(".").slice(0,-1).join("."),l=`${c}_annotated.png`,i=await a.getFileHandle(l,{create:!0}),d=await i.createWritable(),h=document.createElement("canvas"),b=h.getContext("2d"),u=new Image;u.src=Z[o],await new Promise((e=>{u.onload=()=>{var t,s;h.width=u.width,h.height=u.height,b.drawImage(u,0,0),null===(t=K[o])||void 0===t||null===(s=t.result)||void 0===s||s.defects.forEach((e=>{if(e.bbox){const{x1:t,y1:s,x2:n,y2:c}=e.bbox;b.strokeStyle=Ve(e.type),b.lineWidth=2,b.strokeRect(t,s,n-t,c-s),b.fillStyle=Ve(e.type),b.font="16px Arial",b.fillText(e.type,t,s-5)}})),e()}}));const j=await new Promise((e=>h.toBlob(e,"image/png")));await d.write(j),await d.close();const m=`${c}_result.json`,p=await r.getFileHandle(m,{create:!0}),x=await p.createWritable(),g={image:c,defects:(null===(e=K[o])||void 0===e||null===(t=e.result)||void 0===t?void 0:t.defects)||[],statistics:(null===(s=K[o])||void 0===s||null===(n=s.result)||void 0===n?void 0:n.statistics)||{}};await x.write(JSON.stringify(g,null,2)),await x.close()}i.b.success("\u68c0\u6d4b\u7ed3\u679c\u5df2\u6210\u529f\u5bfc\u51fa")}catch(a){console.error("\u5bfc\u51fa\u7ed3\u679c\u5931\u8d25:",a),i.b.error("\u5bfc\u51fa\u7ed3\u679c\u5931\u8d25")}else i.b.warning("\u6ca1\u6709\u53ef\u5bfc\u51fa\u7684\u68c0\u6d4b\u7ed3\u679c")},children:"\u5bfc\u51fa\u7ed3\u679c"}),Object(z.jsx)(h.a,{className:"action-btn",style:{width:"160px"},icon:Object(z.jsx)(E.a,{className:"btn-icon"}),onClick:()=>{if(K&&0!==K.length){i.b.loading("\u6b63\u5728\u751f\u6210\u62a5\u544a...",0);try{const e=document.createElement("div");e.style.position="absolute",e.style.left="-9999px",e.style.top="-9999px",e.style.width="794px",document.body.appendChild(e);const t=new Date,n=t.toLocaleDateString("zh-CN"),a=t.toLocaleTimeString("zh-CN"),r={totalImages:T.length,totalDefects:0,defectTypeCounts:{},imagesWithDefects:0,averageDefectsPerImage:0};K.forEach((e=>{if(e.result&&e.result.defects){const t=e.result.defects;t.length>0&&r.imagesWithDefects++,r.totalDefects+=t.length,t.forEach((e=>{r.defectTypeCounts[e.type]||(r.defectTypeCounts[e.type]=0),r.defectTypeCounts[e.type]++}))}})),r.averageDefectsPerImage=(r.totalDefects/r.totalImages).toFixed(2);let o="";Object.entries(r.defectTypeCounts).forEach((e=>{let[t,s]=e;const n=(s/r.totalDefects*100).toFixed(1);o+=`\n                  <tr>\n                        <td>${t}</td>\n                        <td>${s}</td>\n                        <td>${n}%</td>\n                  </tr>`}));let l="";c&&c.defects&&c.defects.forEach(((e,t)=>{const s=e.bbox?`(${e.bbox.x1.toFixed(0)},${e.bbox.y1.toFixed(0)},${e.bbox.x2.toFixed(0)},${e.bbox.y2.toFixed(0)})`:"\u672a\u77e5",n=e.confidence?`${e.confidence}%`:"\u672a\u77e5";l+=`\n                  <tr>\n                        <td>${t+1}</td>\n                        <td>${e.type}</td>\n                        <td>${s}</td>\n                        <td>${n}</td>\n                  </tr>`})),e.innerHTML=`\n                  <div style="font-family: 'Microsoft YaHei', 'SimHei', sans-serif; padding: 20px; color: #333;">\n                        <style>\n                              table {\n                                    width: 100%;\n                                    border-collapse: collapse;\n                                    margin: 15px 0;\n                              }\n                              th, td {\n                                    border: 1px solid #ddd;\n                                    padding: 8px;\n                                    text-align: center;\n                              }\n                              th {\n                                    background-color: #00539c;\n                                    color: white;\n                                    font-weight: bold;\n                              }\n                              tr:nth-child(even) {\n                                    background-color: #f2f2f2;\n                              }\n                              h1, h2, h3 {\n                                    color: #00539c;\n                                    margin-bottom: 10px;\n                              }\n                              .report-header {\n                                    text-align: center;\n                                    margin-bottom: 20px;\n                              }\n                              .report-date {\n                                    text-align: right;\n                                    color: #666;\n                                    font-size: 12px;\n                                    margin-bottom: 15px;\n                              }\n                              .section {\n                                    margin-bottom: 25px;\n                              }\n                              .footer {\n                                    text-align: center;\n                                    margin-top: 30px;\n                                    font-size: 10px;\n                                    color: #999;\n                                    position: absolute;\n                                    bottom: 20px;\n                                    width: 100%;\n                              }\n                              hr {\n                                    border: 0;\n                                    height: 1px;\n                                    background: #ddd;\n                                    margin: 20px 0;\n                              }\n                              .stats-card {\n                                    background: #f8f9fa;\n                                    border-radius: 8px;\n                                    padding: 15px;\n                                    margin: 10px 0;\n                                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n                              }\n                              .stats-grid {\n                                    display: grid;\n                                    grid-template-columns: repeat(3, 1fr);\n                                    gap: 15px;\n                                    margin: 15px 0;\n                              }\n                              .stat-item {\n                                    background: white;\n                                    padding: 10px;\n                                    border-radius: 6px;\n                                    text-align: center;\n                              }\n                              .stat-value {\n                                    font-size: 24px;\n                                    font-weight: bold;\n                                    color: #00539c;\n                              }\n                              .stat-label {\n                                    font-size: 14px;\n                                    color: #666;\n                              }\n                        </style>\n                        \n                        <div class="report-header">\n                              <h1>PCB\u7f3a\u9677\u68c0\u6d4b\u62a5\u544a</h1>\n                        </div>\n                        \n                        <div class="report-date">\n                              \u62a5\u544a\u751f\u6210\u65f6\u95f4: ${n} ${a}\n                        </div>\n                        \n                        <hr>\n                        \n                        <div class="section">\n                              <h2>\u6279\u6b21\u68c0\u6d4b\u6982\u8ff0</h2>\n                              <div class="stats-grid">\n                                    <div class="stat-item">\n                                          <div class="stat-value">${r.totalImages}</div>\n                                          <div class="stat-label">\u68c0\u6d4b\u603b\u56fe\u7247\u6570</div>\n                                    </div>\n                                    <div class="stat-item">\n                                          <div class="stat-value">${r.totalDefects}</div>\n                                          <div class="stat-label">\u68c0\u51fa\u603b\u7f3a\u9677\u6570</div>\n                                    </div>\n                                    <div class="stat-item">\n                                          <div class="stat-value">${r.averageDefectsPerImage}</div>\n                                          <div class="stat-label">\u5e73\u5747\u6bcf\u56fe\u7f3a\u9677\u6570</div>\n                                    </div>\n                              </div>\n                              \n                              <div class="stats-card">\n                                    <h3>\u6279\u6b21\u7f3a\u9677\u7c7b\u578b\u5206\u5e03</h3>\n                                    <table>\n                                          <thead>\n                                                <tr>\n                                                      <th>\u7f3a\u9677\u7c7b\u578b</th>\n                                                      <th>\u6570\u91cf</th>\n                                                      <th>\u5360\u6bd4</th>\n                                                </tr>\n                                          </thead>\n                                          <tbody>\n                                                ${o}\n                                          </tbody>\n                                    </table>\n                              </div>\n                        </div>\n                        \n                        <hr>\n                        \n                        <div class="section">\n                              <h2>\u5f53\u524d\u56fe\u7247\u68c0\u6d4b\u8be6\u60c5</h2>\n                              <p>\u56fe\u7247\u5e8f\u53f7: ${B+1}/${T.length}</p>\n                              <table>\n                                    <thead>\n                                          <tr>\n                                                <th>\u7f3a\u9677ID</th>\n                                                <th>\u7f3a\u9677\u7c7b\u578b</th>\n                                                <th>\u4f4d\u7f6e\u5750\u6807(x1,y1,x2,y2)</th>\n                                                <th>\u7f6e\u4fe1\u5ea6</th>\n                                          </tr>\n                                    </thead>\n                                    <tbody>\n                                          ${l}\n                                    </tbody>\n                              </table>\n                        </div>\n                        \n                        <div class="footer">\n                              PCB\u7f3a\u9677\u68c0\u6d4b\u7cfb\u7edf\n                        </div>\n                  </div>\n                  `,s.e(0).then(s.t.bind(null,214,7)).then((n=>{(0,n.default)(e,{scale:2,useCORS:!0,logging:!1}).then((n=>{Promise.resolve().then(s.bind(null,179)).then((s=>{const{jsPDF:c}=s,a=n.toDataURL("image/png"),r=new c({orientation:"portrait",unit:"mm",format:"a4"}),o=210*n.height/n.width;let l=o,d=0;for(r.addImage(a,"PNG",0,d,210,o),l-=297;l>0;)d=l-o,r.addPage(),r.addImage(a,"PNG",0,d,210,o),l-=297;const h=`PCB\u7f3a\u9677\u68c0\u6d4b\u62a5\u544a_${t.getTime()}.pdf`;r.save(h),document.body.removeChild(e),i.b.destroy(),i.b.success("\u62a5\u544a\u5df2\u6210\u529f\u5bfc\u51fa")}))}))}))}catch(e){i.b.destroy(),console.error("\u5bfc\u51fa\u62a5\u544a\u51fa\u9519:",e),i.b.error("\u5bfc\u51fa\u62a5\u544a\u5931\u8d25: "+e.message);const t=document.querySelector('div[style*="-9999px"]');t&&document.body.removeChild(t)}}else i.b.warning("\u6ca1\u6709\u68c0\u6d4b\u7ed3\u679c\u53ef\u4f9b\u5bfc\u51fa")},children:"\u5bfc\u51fa\u62a5\u544a"})]})]}),Object(z.jsx)("div",{className:"image-section",children:Object(z.jsxs)("div",{className:"image-container",style:{height:"100%",width:"100%",overflow:"hidden"},children:[Object(z.jsx)("div",{className:"image-wrapper",onMouseEnter:()=>V(!0),onMouseLeave:()=>{V(!1),ut()},onClick:e=>{var t;const s=null===(t=ue.current)||void 0===t?void 0:t.querySelector("img");if(!s)return;const n=s.getBoundingClientRect();(e.clientX<n.left||e.clientX>n.right||e.clientY<n.top||e.clientY>n.bottom)&&(de(1),be({x:0,y:0}))},children:we?Object(z.jsxs)("div",{ref:ue,className:"image-scale-wrapper camera-active",style:{position:"relative",width:"100%",height:"100%",backgroundColor:"#000",overflow:"hidden"},children:[Object(z.jsx)("video",{ref:Ie,autoPlay:!0,playsInline:!0,muted:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"contain",display:"block",zIndex:10}}),Object(z.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:20},children:Ke()}),$e&&Object(z.jsx)("div",{style:{position:"absolute",top:10,right:10,backgroundColor:"rgba(24, 144, 255, 0.8)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",zIndex:30},children:"\u5b9e\u65f6\u68c0\u6d4b\u4e2d..."})]}):r?Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)("div",{ref:ue,className:"image-scale-wrapper",onMouseDown:e=>{0===e.button&&(ce(!0),re({x:e.clientX-he.x,y:e.clientY-he.y}))},onMouseMove:e=>{if(ne){const t=e.clientX-ae.x,s=e.clientY-ae.y,n=300*(ie-1),c=Math.max(Math.min(t,n),-n),a=Math.max(Math.min(s,n),-n);be({x:c,y:a})}},onMouseUp:()=>{ce(!1)},onMouseLeave:ut,onWheel:e=>{var t;if(!(null===(t=ue.current)||void 0===t?void 0:t.querySelector("img")))return;e.preventDefault();const s=-.005*e.deltaY,n=Math.min(Math.max(ie+s,.5),2);if(n===ie)return;const c=ue.current.getBoundingClientRect(),a=e.clientX-c.left,r=e.clientY-c.top,o=c.width/2,l=c.height/2,i=n-ie;let d=he;d=s>0?{x:he.x-i/ie*(a-o),y:he.y-i/ie*(r-l)}:{x:he.x*(n/ie),y:he.y*(n/ie)},de(n),be(d)},style:{cursor:ne?"grabbing":"grab",position:"relative",width:(null===Ye||void 0===Ye?void 0:Ye.width)||"auto",height:(null===Ye||void 0===Ye?void 0:Ye.height)||"auto",maxWidth:"600px",maxHeight:"600px"},children:Object(z.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%",transform:`scale(${ie}) translate(${he.x/ie}px, ${he.y/ie}px)`,transformOrigin:"center",transition:ne?"none":"transform 0.1s ease"},children:[Object(z.jsx)("img",{src:r,alt:"PCB",style:{width:"100%",height:"100%",objectFit:"contain",userSelect:"none"},draggable:!1}),Ke()]})}),T.length>1&&G&&Object(z.jsxs)("div",{className:"image-navigation",children:[Object(z.jsx)(h.a,{icon:Object(z.jsx)(I.a,{}),onClick:()=>{tt(B-1)},disabled:0===B}),Object(z.jsx)(h.a,{icon:Object(z.jsx)($.a,{}),onClick:()=>{tt(B+1)},disabled:B===T.length-1})]})]}):Object(z.jsx)("div",{className:"upload-placeholder",children:Object(z.jsx)(u.a,{accept:"image/*",showUploadList:!1,beforeUpload:Qe,onDrop:e=>{const t=e.dataTransfer.files[0];t&&Qe(t)},children:Object(z.jsxs)("div",{style:{textAlign:"center",cursor:"pointer"},children:[Object(z.jsx)(w.a,{style:{fontSize:"24px",marginBottom:"8px"}}),Object(z.jsx)("p",{children:"\u70b9\u51fb\u6216\u62d6\u62fd\u4e0a\u4f20\u56fe\u7247"})]})})})}),Object(z.jsxs)("div",{className:"detection-progress",children:[Object(z.jsx)("span",{children:"\u68c0\u6d4b\u8fdb\u5ea6:"}),Object(z.jsxs)("div",{style:{display:"flex",alignItems:"center",marginTop:"5px",gap:"10px"},children:[Object(z.jsx)("div",{style:{flex:1,position:"relative"},children:Object(z.jsx)(b.a,{percent:D,showInfo:!1})}),Object(z.jsxs)("span",{style:{fontSize:"14px",color:"#1890ff",fontWeight:"500"},children:[D,"%"]})]})]}),T.length>1&&Object(z.jsx)("div",{className:"image-pagination",children:Object(z.jsx)(j.a,{current:B+1,total:T.length,pageSize:1,onChange:e=>{tt(e-1)},size:"small",showQuickJumper:!0,showSizeChanger:!1})})]})}),Object(z.jsxs)("div",{className:"results-section",children:[Object(z.jsxs)("div",{className:"results-header",children:[Object(z.jsx)("h2",{children:"\u68c0\u6d4b\u7ed3\u679c"}),Object(z.jsx)(m.a,{style:{width:"100%",marginTop:"8px"},value:pe,onChange:e=>{xe(e),Ge(e)},children:Oe.map((e=>Object(z.jsx)(m.a.Option,{value:e,children:"all"===e?"\u5168\u90e8\u7f3a\u9677":e},e)))})]}),Object(z.jsx)("div",{className:"defects-container",style:{height:"350px",overflow:"auto",marginBottom:"16px"},children:Object(z.jsx)("div",{className:"defects-list",ref:Pe,children:ge.length>0?ge.map(((e,t)=>Object(z.jsx)("div",{className:"defect-item",children:Object(z.jsxs)("div",{className:"defect-info",children:[Object(z.jsxs)("h4",{children:[Object(z.jsx)("span",{className:"label-width",children:"\u7c7b\u522b:"})," ",e.type]}),e.bbox&&Object(z.jsxs)("p",{className:"coordinates-info",children:[Object(z.jsxs)("span",{className:"coord-row",children:[Object(z.jsx)("span",{className:"label-width",children:"\u5750\u6807:"}),Object(z.jsxs)("span",{className:"coord-pair",children:["x1=",e.bbox.x1]}),Object(z.jsxs)("span",{className:"coord-pair",children:["y1=",e.bbox.y1]})]}),Object(z.jsxs)("span",{className:"coord-row",children:[Object(z.jsx)("span",{className:"label-width"}),Object(z.jsxs)("span",{className:"coord-pair",children:["x2=",e.bbox.x2]}),Object(z.jsxs)("span",{className:"coord-pair",children:["y2=",e.bbox.y2]})]})]}),e.confidence&&Object(z.jsxs)("p",{children:[Object(z.jsx)("span",{className:"label-width",children:"\u7f6e\u4fe1\u5ea6:"})," ",e.confidence,"%"]})]})},t))):Object(z.jsx)("div",{className:"defect-item empty-defect",children:Object(z.jsxs)("div",{className:"defect-info",children:[Object(z.jsx)("h4",{children:"\u6682\u65e0\u68c0\u6d4b\u7ed3\u679c"}),Object(z.jsx)("p",{children:"\u5f00\u59cb\u68c0\u6d4b\u540e\u5c06\u5728\u6b64\u663e\u793a\u8be6\u7ec6\u4fe1\u606f"})]})})})}),Object(z.jsx)("div",{className:"statistics-section",style:{flex:"2",minHeight:"300px",display:"flex",flexDirection:"column"},children:c.statistics.defect_types&&Object.keys(c.statistics.defect_types).length>0?Object(z.jsx)(k.a,{option:(()=>{var e;const t=null===c||void 0===c||null===(e=c.statistics)||void 0===e?void 0:e.defect_types;if(!t||0===Object.keys(t).length)return{tooltip:{trigger:"item"},legend:{show:!1},series:[]};const s=Object.keys(t),n=s.map((e=>{const t=(()=>{switch(e){case"\u9f20\u54ac":return"mouse_bite";case"\u5f00\u8def":return"open_circuit";case"\u77ed\u8def":return"short";case"\u6bdb\u523a":return"spur";case"\u6742\u94dc":return"spurious_copper";default:return e.toLowerCase()}})();return Ve(t)}));return{tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:10,left:"center",data:s,itemGap:15,height:50},color:n,series:[{name:"\u7f3a\u9677\u7c7b\u578b",type:"pie",radius:"65%",center:["50%","40%"],data:Object.entries(t).map((e=>{let[t,s]=e;return{value:s,name:t}})),label:{show:!0,position:"outside",alignTo:"labelLine",margin:20,formatter:"{b}\n{c} ({d}%)",lineHeight:15,rich:{b:{width:60,align:"left"}}},labelLine:{show:!0,length:15,length2:20,minTurnAngle:120,maxSurfaceAngle:80},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}})(),style:{height:"100%",flex:1},notMerge:!0}):Object(z.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",color:"#aaa"},children:[Object(z.jsx)("p",{style:{margin:0},children:"\u68c0\u6d4b\u5b8c\u6210\u540e\u5c06\u5728\u6b64\u663e\u793a\u7edf\u8ba1\u6570\u636e"}),Object(z.jsx)("p",{style:{margin:0},children:"\u53ef\u68c0\u6d4b: \u9f20\u54ac, \u5f00\u8def, \u77ed\u8def, \u6bdb\u523a\u548c\u6742\u94dc\u7b49"})]})})]}),Object(z.jsxs)("div",{className:"model-section",children:[Object(z.jsxs)("div",{className:"model-header",children:[Object(z.jsx)("h2",{children:"\u6a21\u578b\u7ba1\u7406"}),Object(z.jsxs)(m.a,{value:st,onChange:e=>{switch(nt(e),e){case"yolov11":i.b.info("\u5207\u6362\u5230 Yolov11 \u6a21\u578b");break;case"yolov11-vote2":i.b.info("\u5207\u6362\u5230 Yolov11-vote2 \u6a21\u578b");break;case"yolov11-vote4":i.b.info("\u5207\u6362\u5230 Yolov11-vote4 \u6a21\u578b");break;default:i.b.warning("\u672a\u77e5\u6a21\u578b\u9009\u62e9")}},style:{width:"100%"},children:[Object(z.jsx)(m.a.Option,{value:"yolov11",children:"Yolov11"}),Object(z.jsx)(m.a.Option,{value:"yolov11-vote2",children:"Yolov11-vote2"}),Object(z.jsx)(m.a.Option,{value:"yolov11-vote4",children:"Yolov11-vote4"})]})]}),Object(z.jsxs)("div",{className:"metrics",children:[Object(z.jsxs)("div",{className:"metric-item",children:[Object(z.jsx)("span",{children:"Precision"}),Object(z.jsx)("span",{className:"metric-value",children:"yolov11"===st?"97.72%":"yolov11-vote2"===st?"97.45%":"96.99%"})]}),Object(z.jsxs)("div",{className:"metric-item",children:[Object(z.jsx)("span",{children:"Recall"}),Object(z.jsx)("span",{className:"metric-value",children:"yolov11"===st?"84.41%":"yolov11-vote2"===st?"85.97%":"87.32%"})]}),Object(z.jsxs)("div",{className:"metric-item",children:[Object(z.jsx)("span",{children:"mAP@0.5"}),Object(z.jsx)("span",{className:"metric-value",children:"yolov11"===st?"92.39%":"yolov11-vote2"===st?"93.02%":"93.58%"})]}),Object(z.jsxs)("div",{className:"metric-item",children:[Object(z.jsx)("span",{children:"mAP@0.5:0.95"}),Object(z.jsx)("span",{className:"metric-value",children:"yolov11"===st?"68.18%":"yolov11-vote2"===st?"69.20%":"69.49%"})]})]}),Object(z.jsxs)("div",{className:"threshold-settings",children:[Object(z.jsx)("h3",{children:"\u9608\u503c\u8bbe\u7f6e"}),Object(z.jsxs)("div",{className:"threshold-item",children:[Object(z.jsx)("span",{children:"IoU \u9608\u503c"}),Object(z.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[Object(z.jsxs)("div",{className:"custom-input-number",children:[Object(z.jsx)(p.a,{min:.1,max:1,step:.01,value:ct,onChange:e=>at(e||.1),style:{width:"80px"},controls:!1,className:"threshold-input"}),Object(z.jsxs)("div",{className:"custom-controls",children:[Object(z.jsx)("div",{className:"control-up",onClick:()=>{const e=parseFloat((ct+.01).toFixed(2));e<=1&&at(e)},children:Object(z.jsx)("div",{className:"control-icon",children:"+"})}),Object(z.jsx)("div",{className:"control-down",onClick:()=>{const e=parseFloat((ct-.01).toFixed(2));e>=.1&&at(e)},children:Object(z.jsx)("div",{className:"control-icon",children:"-"})})]})]}),Object(z.jsx)(x.a,{min:.1,max:1,step:.01,value:ct,onChange:e=>at(e),tooltip:{formatter:e=>`IoU: ${e.toFixed(2)}`},style:{flex:1}})]})]}),Object(z.jsxs)("div",{className:"threshold-item",children:[Object(z.jsx)("span",{children:"\u7f6e\u4fe1\u5ea6\u9608\u503c"}),Object(z.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[Object(z.jsxs)("div",{className:"custom-input-number",children:[Object(z.jsx)(p.a,{min:.1,max:1,step:.01,value:rt,onChange:e=>ot(e||.1),style:{width:"80px"},controls:!1,className:"threshold-input"}),Object(z.jsxs)("div",{className:"custom-controls",children:[Object(z.jsx)("div",{className:"control-up",onClick:()=>{const e=parseFloat((rt+.01).toFixed(2));e<=1&&ot(e)},children:Object(z.jsx)("div",{className:"control-icon",children:"+"})}),Object(z.jsx)("div",{className:"control-down",onClick:()=>{const e=parseFloat((rt-.01).toFixed(2));e>=.1&&ot(e)},children:Object(z.jsx)("div",{className:"control-icon",children:"-"})})]})]}),Object(z.jsx)(x.a,{min:.1,max:1,step:.01,value:rt,onChange:e=>ot(e),tooltip:{formatter:e=>`Conf: ${e.toFixed(2)}`},style:{flex:1}})]})]})]})]})]})})]}):Object(z.jsx)(Y,{onLoginSuccess:jt})};s(212);r.a.render(Object(z.jsx)(c.a.StrictMode,{children:Object(z.jsx)(G,{})}),document.getElementById("root"))}},[[213,2,3]]]);
//# sourceMappingURL=main.3ae5b672.chunk.js.map